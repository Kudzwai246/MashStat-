<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>MaRankings ‚Äì Zimbabwe Music Charts</title>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8BMMTDWP3G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'G-8BMMTDWP3G');
  </script>  <!-- Firebase SDKs -->  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body { background: #0d0d0d; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; padding: 20px; }
    header { text-align: center; margin-bottom: 20px; }
    header a.main { color: #ff3c78; font-size: 2.5rem; font-weight: bold; text-decoration: none; }
    header h2.sub { color: #bbbbbb; margin-top: 8px; font-size: 1.5rem; }
    #searchBar { width:100%; padding:12px; margin:20px 0; font-size:1rem; border:none; border-radius:8px; background:#1a1a1a; color:#e0e0e0; }
    .section { margin-top:30px; }
    .section h3 { color:#ff3c78; font-size:1.5rem; font-weight:700; margin-bottom:15px; border-bottom:2px solid #ff3c78; display:inline-block; padding-bottom:4px; }
    #cityList { display:flex; flex-wrap:wrap; gap:16px; }
    .city-card { background:#181818; padding:12px; border-radius:8px; width:200px; cursor:pointer; }
    .city-card:hover { background:#242424; }
    .city-card h4 { color:#ff3c78; margin-bottom:8px; }
    #artistContainer { display: grid; grid-template-columns: repeat(2,1fr); gap: 20px; }
    .artist-card { background:#181818; border-radius:12px; overflow:hidden; box-shadow:0 6px 20px rgba(0,0,0,0.4); transition:transform 0.2s; padding-bottom:10px; }
    .artist-card:hover { transform:scale(1.02); }
    .artist-img { display:block; width:100%; height:180px; object-fit:cover; background:#333; }
    .artist-details { padding:1rem; }
    .artist-name { font-size:1.3rem; margin-bottom:0.5rem; color:#fff; font-weight:600; }
    .meta-block { margin-bottom:12px; }
    .meta-block h4 { margin-bottom:6px; font-size:1rem; color:#ff3c78; font-weight:600; }
    .meta-block p { font-size:0.9rem; color:#ccc; margin:2px 0; }
    .artist-links a { display:inline-block; margin:4px 6px 0 0; font-size:0.8rem; text-decoration:none; padding:6px 10px; border-radius:5px; transition:background-color 0.3s; color:#fff; }
    .artist-links a.spotify { background:#4da6ff; }
    .artist-links a.youtube { background:#ff0000; }
    .artist-links a.itunes  { background:#fa2a55; }
    #loading { text-align:center; color:#888; font-size:1rem; margin:20px 0; }
    footer { text-align:center; margin-top:40px; font-size:0.8rem; color:#777; }
  </style></head>
<body>
  <header>
    <a href="index.html" class="main">MashStat</a>
    <h2 class="sub">MaRankings</h2>
  </header>  <input id="searchBar" placeholder="Search for any artist (Zimbabwean or international) and hit Enter‚Ä¶" />  <!-- City Popularity Section -->  <div class="section">
    <h3>üìç City Popularity</h3>
    <div id="cityList"></div>
  </div>  <!-- Hard On The Rise -->  <div class="section">
    <h3>üèÜ Hard On The Rise (This Month)</h3>
    <div id="risingGrid"></div>
  </div>  <!-- Tracked Artists -->  <div class="section">
    <h3>üéµ Tracked Artists</h3>
    <div id="loading">Loading artists‚Ä¶</div>
    <div id="artistContainer"></div>
  </div>  <footer>
    Data sources: Spotify Web API ¬∑ YouTube Data API ¬∑ iTunes Search API<br>
    ¬© 2025 MashStat / MaRankings
  </footer>  <script>
    // Firebase init
    firebase.initializeApp({
      apiKey: "AIzaSyDyJg5BfmGhoi5ESsfhF6ZRFDG0Xfdoy10",
      authDomain: "mashstat-vote.firebaseapp.com",
      projectId: "mashstat-vote"
    });
    const db = firebase.firestore();

    // Vote aggregation helpers
    async function fetchAllVotes() {
      const snap = await db.collection('votes').get();
      return snap.docs.map(d=>d.data());
    }
    function aggregateVotes(votes) {
      const totalByArtist = {}, cityByArtist = {};
      votes.forEach(v=>{
        const art = v.song.artist;
        totalByArtist[art] = (totalByArtist[art]||0)+1;
        cityByArtist[art] = cityByArtist[art]||{};
        const c=v.city||'Unknown'; cityByArtist[art][c]=(cityByArtist[art][c]||0)+1;
      });
      return { totalByArtist, cityByArtist };
    }
    function showCityPopularity() {
      fetchAllVotes().then(votes=>{
        const { totalByArtist, cityByArtist } = aggregateVotes(votes);
        const sorted = Object.entries(totalByArtist).sort((a,b)=>b[1]-a[1]);
        const container = document.getElementById('cityList');
        sorted.forEach(([artist,count],i)=>{
          const topCities = Object.entries(cityByArtist[artist]||{}).sort((a,b)=>b[1]-a[1]).slice(0,3);
          const card = document.createElement('div'); card.className='city-card';
          card.innerHTML = `<h4>#${i+1} ${artist}</h4><p>Total votes: ${count}</p><div id="bar${i}"></div>`;
          card.addEventListener('click',()=> showArtistDetails(artist));
          container.appendChild(card);
          const max=topCities[0]?topCities[0][1]:1;
          topCities.forEach(([city,c])=>{
            const w = (c/max)*100;
            const barWrap=document.createElement('div'); barWrap.style.display='flex'; barWrap.style.alignItems='center'; barWrap.style.margin='4px 0';
            const lbl=document.createElement('div'); lbl.textContent=city; lbl.style.width='60px'; lbl.style.fontSize='0.8em';
            const bar=document.createElement('div'); bar.style.height='8px'; bar.style.width=w+'%'; bar.style.background='#4da6ff'; bar.style.marginLeft='6px';
            barWrap.append(lbl,bar); card.querySelector(`#bar${i}`).appendChild(barWrap);
          });
        });
      });
    }

    // MaRankings existing code
    const zimArtists  = [...]; const intlArtists=[...]; const tracked=[...zimArtists,...intlArtists];
    // (Spotify fetchArtist, buildCard, render as before)

    // Show artist details on card click
    function showArtistDetails(name) {
      document.getElementById('artistContainer').innerHTML='';
      fetchArtist(name, spotifyToken).then(d=>{
        document.getElementById('artistContainer').appendChild(buildCard(d));
      });
    }

    // Initial sequence
    showCityPopularity();
    render();
  </script></body>
</html>
